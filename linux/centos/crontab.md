# crontab用法
crontab的服务进程名为crond，英文意为周期任务。顾名思义，crontab在Linux主要用于周期定时任务管理。通常安装操作系统后，默认已启动crond服务。crontab可理解为cron_table，表示cron的任务列表。

关于crontab的用途很多，如：
- 定时系统检测
- 定时数据采集；
- 定时日志备份；
- 定时更新数据缓存；
- 定时生成报表；
- ...等等任务；

# 新建crontab任务
$ crontab -e      // 打开crontab任务编辑
```shell
* * * * * date >> /tmp/time.txt
```

保存退出后，查看执行情况： cat /tmp/time.txt

# crontab选项
-e 选项 表示打开当前用户的crontab任务列表配置文件。当然也可以直接打开，路径通常是在/var/spool/cron/下，文件以用户名命名，如/var/spool/cron/root。不过，采用-e方式打开，福利是可以帮助我们自动检查任务配置符合规则。

-u 选项 指定某用户的任务列表，很好理解。比如我当前是root用户，想操作poloxue用户的任务列表。如下：$ crontab -u poloxue -e

-l 选项 列出某用户的所有任务列表

-r 选项 删除某用户的所有任务列表，这个选项使用小心为上，估计也只是自己实验时玩玩而已，正常不使用。

crontab命令的选项中，主要使用的就是以上几个，理解比较简单

# 任务配置
crontab任务列表配置格式，示例文件如下：
```shell
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root

# 计划任务定义的例子:
# .---------------- 分 (0 - 59)
# |  .------------- 时 (0 - 23)
# |  |  .---------- 日 (1 - 31)
# |  |  |  .------- 月 (1 - 12)
# |  |  |  |  .---- 星期 (0 - 7) (星期日可为0或7)
# |  |  |  |  |
# *  *  *  *  * 执行的命令
* * * * * date >> /time.txt 2>&1

```
crontab的任务列表主要由两部分组成：环境变量配置与定时任务配置

# 环境变量配置部分
理解环境变量配置这部分可以帮助我们减少去踩一些不必要的坑。简单说明上面涉及的环境变量。
SHELL为/bin/bash，表示使用/bin/bash解释执行命令
PATH表示到哪些目录路径寻找命令程序，此环境变量的值说明了为什么我们在crontab中执行命令时，尽量要写命令全路径才能执行的原因。
MAILTO变量作用是当任务执行有输出时，内容发送到哪个用户的邮箱。禁用可以设置MAILTO=""。

当我们在使用crontab时，发现某些定时任务不能顺利执行，但shell控制台执行成功，环境变量是否正确是我们需要首先关注的点之一。

# 定时任务配置部分
如下所示配置共6列，前5列是关于执行时间配置，最后1列是具体执行命令。
```
.---------------- 分 (0 - 59)
|  .------------- 时 (0 - 23)
|  |  .---------- 日 (1 - 31) 
|  |  |  .------- 月 (1 - 12) 
|  |  |  |  .---- 星期 (0 - 6) (星期日可为0或7) 
|  |  |  |  | 
*  *  *  *  * 执行的命令
```
- 第一列单位为分，表示每时第几分钟，范围为0-59；
- 第二列单位为时，表示每天第几小时，范围为0-23；
- 第三列单位为日，表示每月第几天，范围为1-31；
- 第四列单位为月，表示每年第几月，范围为1-12；
- 第五列单位为星期，表示每星期第几天，范围0-7，0与7表示星期日，其他分别为星期1-6；

# 时间配置段类型
根据时间列中值的不同设置方式，编者总结出以下五种类型：
- 固定某值，指定固定值，如指定1月1日0时0分执行任务
    0 0 1 1 * command
    月日时分都指定了固定数值。注：*在crontab中表示任意值都满足条件
- 列表值，时间值是一个列表，如指定一个月内2、12、22日零时执行任务
    0 0 2,12,22 * * command
    上述日指定多个值，2号、12号和22号，以逗号分隔；
- 连续范围值，时间为连续范围的值，如指定每个月1至7号零时执行任务
    0 0 1-7 * * command
    上述日期为连续范围的值1-7时
- 步长值，根据指定数值跳跃步长确定执行时间，如指定凌晨1时开始每割3个小时0分执行一次任务
    0 1-24/3 * * * command
    上述指定从凌晨1时每3个小时执行任务，如1点0分，4点0分，7点0分等。
- 混合值，支持以上类型的组合，如指定每小时0至10分，22、33分以及0-60分钟每隔20分钟执行任务，如下:
    0-10,22,33,*/20 * * * * command
    这里的分钟值采取了多种类型组合指定，包括连续范围值(0-7)，列表值(22,33)，步长值(*/20)

# 整点时间设置
    0 3 * * * command
    每天3点0时执行任务
# 日与星期的关系
    0 0 1-7 * * date >> /tmp/date.txt
    设置任务一：每月的1-7每天零时执行某任务

    0 0 * * 1 date >> /tmp/date.txt
    设置任务二：每星期的星期一零时执行某任务

    当日和星期任一列包含时，日与星期两者为并且的关系；
    当日和星期列中不包含时，日与星期两者为或者的关系；

# 环境变量
    * * * * * source /$HOME/.bash_profile && command
    直接在crontab配置中加入变量配置

# 文件描述符
| 类型 	| 文件描述符 	| 默认状况 	| 对应文件句柄位置
|:-----------------|:--------------------------------------|:-----------|:-----------|
|标准输入（standard input）| 	0 	| 从键盘得到输入| 	/proc/self/fd/0
|标准输出（standard output）| 	1 	| 输出到屏幕（即控制台）| 	/proc/self/fd/1
|错误输出（error output）| 	2 	| 输出到屏幕（即控制台）| 	/proc/self/fd/2

# 输出重定向
输出重定向的使用方式很简单，基本的一些命令以下:
| 类型 	| 文件描述符 |
|:-----------------|:--------------------------------------|
| command >filename |	把标准输出重定向到新文件中|
| command 1>filename |	同上|
| command >>filename |	把标准输出追加到文件中 |
| command 1>>filename |	同上 |
| command 2>filename |	把标准错误重定向到新文件中 |
| command 2>>filename |	把标准错误追加到新文件中 |


对输入重定向的基本命令以下：
| 命令          | 标准输出 | 错误输出 |
|:-----------------|:--------------------------------------|:-----------|
| >/dev/null 2>&1    | 丢弃 | 丢弃 |
| 2>&1 >/dev/null    | 丢弃 | 屏幕 |
